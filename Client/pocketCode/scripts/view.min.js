'use strict';PocketCode.Ui.PageView=(function(){PageView.extends(SmartJs.Ui.ContainerControl,false);function PageView(a){SmartJs.Ui.ContainerControl.call(this,{className:'pc-page'}.merge(a));this._header=new SmartJs.Ui.ContainerControl({className:'pc-pageHeader'});this._appendChild(this._header);this._captionArea=new SmartJs.Ui.ContainerControl();this._caption=new SmartJs.Ui.TextNode();this._captionArea.appendChild(this._caption);this._container=new SmartJs.Ui.ContainerControl({className:'pc-pageBody'});this._bodyLayout=new SmartJs.Ui.ContainerControl({className:'pc-pageBodyLayout'});this._bodyLayout.appendChild(this._container);this._appendChild(this._bodyLayout);this._footer=new SmartJs.Ui.ContainerControl({className:'pc-pageFooter'});this._appendChild(this._footer);this._onResize.addEventListener(new SmartJs.Event.EventListener(this._handleResize,this))}PageView.prototype.merge({_handleResize:function(e){var a=this._bodyLayout.style,hh=this._header.hidden,fh=this._footer.hidden;if(!hh&&!fh)a.paddingBottom=(this._header.height+this._footer.height)+'px';else if(hh&&fh)a.paddingBottom='0';else if(hh)a.paddingBottom=this._footer.height+'px';else if(fh)a.paddingBottom=this._header.height+'px';this._container.verifyResize(this)},hideHeader:function(){this._header.hide();this._handleResize()},showHeader:function(){this._header.show();this._handleResize()},hideFooter:function(){this._footer.hide();this._handleResize()},showFooter:function(){this._footer.show();this._handleResize()},dispose:function(){this._onResize.removeEventListener(new SmartJs.Event.EventListener(this._handleResize,this))},});return PageView})();

PocketCode.Ui.PlayerPageView=(function(){PlayerPageView.extends(PocketCode.Ui.PageView,false);function PlayerPageView(){PocketCode.Ui.PageView.call(this);if(SmartJs.Device.isMobile){var a=new PocketCode.Ui.PlayerSvgButton(PocketCode.Ui.SvgImageString.BACK,'lblExit');a.className='pc-webButton pc-backButton pc-rtl';a.onClick.addEventListener(new SmartJs.Event.EventListener(function(e){this._onExit.dispatchEvent()},this));this._header.appendChild(a);this._header.style.padding='8px'}else this._header.hide();this._footer.hide();if(SmartJs.Device.isIOs||SmartJs.Device.isFirefoxOS)this._toolbar=new PocketCode.Ui.PlayerToolbar(PocketCode.Ui.PlayerToolbarSettings.MOBILE_IOS);else if(SmartJs.Device.isMobile)this._toolbar=new PocketCode.Ui.PlayerToolbar(PocketCode.Ui.PlayerToolbarSettings.MOBILE);else{this._toolbar=new PocketCode.Ui.PlayerToolbar(PocketCode.Ui.PlayerToolbarSettings.DESKTOP)}this.appendChild(this._toolbar);if(PocketCode.Player.Ui.Menu){this._menu=new PocketCode.Player.Ui.Menu();if(SmartJs.Device.isMobile)this.appendChild(this._menu);else this.onResize.addEventListener(new SmartJs.Event.EventListener(function(){this._menu.verifyResize()},this))}this._startScreen=new PocketCode.Ui.PlayerStartScreen();this.appendChild(this._startScreen);this._startScreen.hide();this.disabled=true;this._onExit=new SmartJs.Event.Event(this)}Object.defineProperties(PlayerPageView.prototype,{menu:{get:function(){return this._menu},},executionState:{get:function(){return this._toolbar.executionState},set:function(a){this._toolbar.executionState=a;if(SmartJs.Device.isMobile){switch(a){case PocketCode.ExecutionState.PAUSED:case PocketCode.ExecutionState.STOPPED:this._menu.show();break;default:this._menu.hide();break}}},},disabled:{set:function(a){this._toolbar.disabled=a;this._startScreen.startEnabled=!a},},axesButtonChecked:{set:function(a){this._toolbar.axesButtonChecked=a},},axesButtonDisabled:{set:function(a){this._toolbar.axesButtonDisabled=a},},backButtonDisabled:{set:function(a){this._toolbar.backButtonDisabled=a},},screenshotButtonDisabled:{set:function(a){this._toolbar.screenshotButtonDisabled=a},},});Object.defineProperties(PlayerPageView.prototype,{onToolbarButtonClicked:{get:function(){return this._toolbar.onButtonClicked},},onMenuAction:{get:function(){if(this._menu)return this._menu.onMenuAction;else return new SmartJs.Event.Event(this)},},onMenuOpen:{get:function(){if(this._menu)return this._menu.onOpen;else return new SmartJs.Event.Event(this)},},onStartClicked:{get:function(){return this._startScreen.onStartClicked},},onExitClicked:{get:function(){return this._onExit},},});PlayerPageView.prototype.merge({showStartScreen:function(a,b){this._startScreen.title=a;if(b=="null")this._startScreen.previewImage=PocketCode.domain+'/images/default/screenshot.png';else if(b)this._startScreen.previewImage=b;this._startScreen.setProgress(0);this._startScreen.show()},hideStartScreen:function(){this._startScreen.hide();this.hideHeader()},setLoadingProgress:function(a){this._startScreen.setProgress(a)},closeMenu:function(){this._menu.close()},});return PlayerPageView})();

'use strict';PocketCode.Ui.PlayerViewportView=(function(){PlayerViewportView.extends(SmartJs.Ui.Control,false);function PlayerViewportView(){SmartJs.Ui.Control.call(this,'div',{className:'pc-playerViewportView'});this._dom.dir='ltr';this._originalWidth=200;this._originalHeight=380;this.__resizeLocked=false;this._axesVisible=false;this._activeAskDialog=undefined;this._canvas=new PocketCode.Ui.Canvas();this._appendChild(this._canvas);this._onResize.addEventListener(new SmartJs.Event.EventListener(function(){window.setTimeout(this._updateCanvasSize.bind(this),120)},this));this._onUserAction=new SmartJs.Event.Event(this);this._canvas.onRenderingSpriteTouched.addEventListener(new SmartJs.Event.EventListener(function(e){this._onUserAction.dispatchEvent(e.merge({action:PocketCode.UserActionType.SPRITE_CLICKED}))},this));this._canvas.onTouchStart.addEventListener(new SmartJs.Event.EventListener(function(e){this._onUserAction.dispatchEvent(e.merge({action:PocketCode.UserActionType.TOUCH_START}))},this));this._canvas.onTouchMove.addEventListener(new SmartJs.Event.EventListener(function(e){this._onUserAction.dispatchEvent(e.merge({action:PocketCode.UserActionType.TOUCH_MOVE}))},this));this._canvas.onTouchEnd.addEventListener(new SmartJs.Event.EventListener(function(e){this._onUserAction.dispatchEvent(e.merge({action:PocketCode.UserActionType.TOUCH_END}))},this))}Object.defineProperties(PlayerViewportView.prototype,{onUserAction:{get:function(){return this._onUserAction}},});Object.defineProperties(PlayerViewportView.prototype,{_mobileResizeLocked:{set:function(a){if(!SmartJs.Device.isMobile)return;if(typeof a!='boolean')throw new Error('invalid parameter: setter: resizeLocked');if(this.__resizeLocked==a)return;this.__resizeLocked=a;if(a){var b=this._canvas;b.style.width=b.width+'px';b.style.height=b.height+'px';SmartJs.Ui.Window.onResize.addEventListener(new SmartJs.Event.EventListener(this._windowOrientationChangeHandler,this))}else{this.style.width='100%';this.style.height='100%';SmartJs.Ui.Window.onResize.removeEventListener(new SmartJs.Event.EventListener(this._windowOrientationChangeHandler,this))}},},axisVisible:{get:function(){return this._axesVisible},},renderingSprites:{set:function(a){this._canvas.renderingSprites=a},},renderingTexts:{set:function(a){this._canvas.renderingTexts=a},},});PlayerViewportView.prototype.merge({_windowOrientationChangeHandler:function(e){var a=this._canvas;a.style.left=Math.floor((e.width-a.width)*0.5)+'px'},_updateCanvasSize:function(){if(this.__resizeLocked)return;var w=this.width,h=this.height,ow=this._originalWidth,oh=this._originalHeight,scaling;if(!w||!h||!ow||!oh)return;if(oh/ow>=h/w)scaling=h/oh;else scaling=w/ow;var a=this._canvas,cw=Math.ceil(ow*scaling*0.5)*2.0,ch=Math.ceil(oh*scaling*0.5)*2.0;a.setDimensions(cw,ch,scaling,scaling);if(SmartJs.Device.isMobile){a.style.left=Math.floor((w-cw)*0.5)+'px';a.style.top=Math.floor((h-ch)*0.5)+'px'}this.render();this._drawAxes()},setOriginalViewportSize:function(a,b){this._originalWidth=a;this._originalHeight=b;this._updateCanvasSize()},showAskDialog:function(a,b){var c=new PocketCode.Ui.AskDialog(a);this._activeAskDialog=c;c.onSubmit.addEventListener(new SmartJs.Event.EventListener(function(e){e.target.dispose();if(SmartJs.Device.isMobile){this._mobileResizeLocked=false}b(e.answer)},this));if(SmartJs.Device.isMobile){window.setTimeout(function(){this._appendChild(c);this._updateCanvasSize();this._mobileResizeLocked=true;c.focusInputField()}.bind(this),500)}else{this._appendChild(c);c.focusInputField()}},initScene:function(a,b,c){this._canvas.initScene(a,b);if(c)this._canvas.clearCurrentPenStampCache();this.render()},drawStamp:function(a){this._canvas.drawStamp(a)},movePen:function(a,b,c){this._canvas.movePen(a,b,c)},clearCurrentPenStampCache:function(){this._canvas.clearCurrentPenStampCache()},clear:function(){if(this._activeAskDialog)this._activeAskDialog.dispose();this._canvas.clearPenStampCache()},updateCameraUse:function(a,b){this._canvas.cameraStream=b;this._canvas.cameraOn=a},showAxes:function(){if(this._axesVisible)return;this._axesVisible=true;this._drawAxes()},hideAxes:function(){if(!this._axesVisible)return;this._axesVisible=false;this._clearAxes()},_drawAxes:function(){if(!this._axesVisible)return;var a=this._canvas.contextTop,width=this._canvas.width,height=this._canvas.height,color='red',pixelRatio=1;a.save();a.beginPath();a.moveTo(Math.round(width*0.5),0);a.lineTo(Math.round(width*0.5),height);a.moveTo(0,Math.round(height*0.5));a.lineTo(width,Math.round(height*0.5));a.strokeStyle=color;a.lineWidth=pixelRatio;a.font=(12*pixelRatio)+'px Arial';a.fillStyle=color;a.fillText('0',width*0.5+5,height*0.5+15);a.fillText('-'+this._originalWidth*0.5,5,height*0.5+15);a.fillText(this._originalWidth*0.5,width-25,height*0.5+15);a.fillText(this._originalHeight*0.5,width*0.5+5,15);a.fillText('-'+this._originalHeight*0.5,width*0.5+5,height-5);a.stroke();a.restore()},_clearAxes:function(){var a=this._canvas.contextTop;a.clearRect(0,0,this._canvas.width,this._canvas.height)},getCanvasDataURL:function(){var a=this._canvas.toDataURL(this._originalWidth,this._originalHeight);return a},render:function(){this._redrawRequired=true;if(this._redrawInProgress)return;this._redrawInProgress=window.requestAnimationFrame(this._redrawCanvas.bind(this))},_redrawCanvas:function(){this._redrawRequired=false;this._canvas.render();this._redrawInProgress=false;if(this._redrawRequired)this.render()},dispose:function(){SmartJs.Ui.Window.onResize.removeEventListener(new SmartJs.Event.EventListener(this._windowOrientationChangeHandler,this));this.onResize.dispose();SmartJs.Ui.Control.prototype.dispose.call(this)},});return PlayerViewportView})();
