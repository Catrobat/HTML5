<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Display Webcam Stream</title>

    <style>
        #container {
            margin: 0px auto;
            width: 500px;
            height: 375px;
            border: 10px #333 solid;
        }
        @-webkit-keyframes rotate {
           100%{
               -webkit-transform: rotate(30deg);
           }
        }
        #videoElement {
            width: 0px;
            height: 0px;
            background-color: #666;
            display: none;
        }
        #canvas {
            width: 500px;
            height: 375px;
            -webkit-filter: grayscale(100%);
            -webkit-animation: rotate 5s infinite linear;

            background-color: #CCC;
        }
    </style>

</head>

<body>
<!-- On iOS 6 we can use the file select input with the following attributes to capture an image from the camera -->
Camera:
<select id="videoSource">

</select>
<break />

<!-- For devices that support getUserMedia and have a webcam we can display the feed in a video element -->
    <video autoplay id="videoElement">

    </video>


<canvas id="canvas" width="500" height="375"></canvas>


<script>
    console.log("navigator:", navigator);
    var video = document.querySelector("#videoElement");
    var v,canvas,context,w,h;
    var videoSelect = document.querySelector('select#videoSource');

    // check for getUserMedia support
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;

    if (navigator.getUserMedia) {
        // get webcam feed if available
        navigator.mediaDevices.getUserMedia({video: true}, handleVideo, videoError);
    }

    function handleVideo(stream) {
        // if found attach feed to video element
        window.stream = stream;
        video.src = window.URL.createObjectURL(stream);
        video.play();
    }

    function gotSources(sourceInfos) {
        for (var i = 0; i !== sourceInfos.length; ++i) {
            var sourceInfo = sourceInfos[i];
            var option = document.createElement('option');
            option.value = sourceInfo.devide;
         if (sourceInfo.kind === 'videoinput') {
                option.text = sourceInfo.label || 'camera ' + (videoSelect.length + 1);
                videoSelect.appendChild(option);
            } else {
                console.log('Some other kind of source: ', sourceInfo);
            }
        }
    }


    function videoError(error) {
        console.log("error:", error);
        if (error.name === 'ConstraintNotSatisfiedError') {
            console.log('The resolution ' + constraints.video.width.exact + 'x' +
                    constraints.video.width.exact + ' px is not supported by your device.');
        } else if (error.name === 'PermissionDeniedError') {
            console.log('Permissions have not been granted to use your camera and ' +
                    'microphone, you need to allow the page access to your devices in ' +
                    'order for the demo to work.');
        }
        console.log('getUserMedia error: ' + error.name, error);
    }

    var imgtag = document.getElementById('imgtag'); // get reference to img tag
    var sel = document.getElementById('fileselect'); // get reference to file select input element

    document.addEventListener('DOMContentLoaded', function(){
        // when DOM loaded, get canvas 2D context and store width and height of element
        v = document.getElementById('videoElement');
        canvas = document.getElementById('canvas');
        context = canvas.getContext('2d');
        context.drawImage(video, 0,0);

        w = canvas.width;
        h = canvas.height;

        navigator.mediaDevices.enumerateDevices().then(gotSources).catch(videoError);

        video.addEventListener('play',function(e){

            draw(v,context,w,h);
// when save button is clicked, draw video feed to canvas

        });

    },false);

    function draw(v,context,w,h) {

        if(v.paused || v.ended) return false; // if no video, exit here

        context.drawImage(v,0,0,w,h); // draw video feed to canvas
        setTimeout(draw, 10, v, context, w, h);
    }

    function changeSource() {
        if (window.stream) {
            video.src = null;
            window.stream.stop();
        }
        var videoSource = videoSelect.value;
        var constraints = {
            video: {
                optional: [{
                    sourceId: videoSource
                }]
            }
        };
        navigator.getUserMedia(constraints, handleVideo, videoError);
    }
    videoSelect.onChange = changeSource;

    </script>
</body>
</html>