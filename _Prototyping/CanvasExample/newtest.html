<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Canvas Test</title>

    <script src="../../Client/pocketCode/libs/soundjs/soundjs-0.6.0.js"></script>
    <script src="../../Client/pocketCode/libs/fabric/fabric-1.4.0.js" ></script>

    <script src="../../Client/smartJs/sj.js"></script>
    <script src="../../Client/smartJs/sj-core.js"></script>
    <script src="../../Client/smartJs/sj-event.js"></script>
    <script src="../../Client/smartJs/sj-components.js"></script>
    <script src="../../Client/smartJs/sj-animation.js"></script>
    <script src="../../Client/smartJs/sj-communication.js"></script>
    <script src="../../Client/smartJs/sj-ui.js"></script>

    <script src="../../Client/pocketCode/scripts/core.js" data-cover></script>
    <!-- model -->
    <script src="../../Client/pocketCode/scripts/model/bricksCore.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/bricksControl.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/bricksMotion.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/bricksSound.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/bricksLook.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/bricksVariable.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/sprite.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/model/renderingItem.js" data-cover></script>

    <!-- components -->
    <script src="../../Client/pocketCode/scripts/components/mvc.js"></script>
    <script src="../../Client/pocketCode/scripts/components/proxy.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/components/soundManager.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/components/broadcastManager.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/components/device.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/components/canvas.js" data-cover></script>
    <script src="../../Client/pocketCode/scripts/components/gameEngine.js" data-cover></script>
    <script src="../../Client/PocketCodePlayer/controller/canvasController.js"></script>
    <script src="../../Client/pocketCode/scripts/uiControls/playerViewport.js"></script>
    <link href="../../Client/pocketCode/css/pocketCode.css" rel="stylesheet">

</head>
<body>
</body>
<script type="text/javascript">

    function populateSprites(id, name, layer, x, y, scale, imgElement, visible, bright, transp, angle) {
        var sprite = new PocketCode.Model.Sprite(new PocketCode.GameEngine(), { id: "newId", name: "myName" });

        sprite.id = id;
        sprite.name = name;
        //sprite.layer = layer;
        sprite.setPositionX(x);
        sprite.setPositionY(y);
        sprite.setSize(scale);
        sprite.looks = imgElement;
        sprite.setGraphicEffect(PocketCode.GraphicEffect.GHOST, transp);
        sprite.setGraphicEffect(PocketCode.GraphicEffect.BRIGHTNESS, bright);
        sprite.setDirection(angle);
        if (visible)
            sprite.show();
        else
            sprite.hide();

        return sprite;

    }

    //create 5 sprites
    var sprites = [];
    var onLoad = function () {
        for (var i = 0; i < 5; i++) {
            sprites.push(populateSprites(i, 'tree', i, 50 * i, 50 * i, 20, looks, true, i * 60, 0, 90));
        }

    };
    var _testhandler = function(e) {
        console.log(e.id);
    } ;

    var onLoad2 = function() {
        sprites.push(populateSprites(6, 'minion', 6, 50 * 6, 50 * 6, 20, looks2, true, 6 * 60, 0, 90));
        // var ge = new PocketCode.GameEngine();
        var c = new PocketCode.CanvasController(sprites);
        c.onSpriteClicked.addEventListener(new SmartJs.Event.EventListener(_testhandler, this));
        //console.log(document);
        document.body.appendChild(c._view._dom);
        console.log(c.downloadCanvas(2));
        console.log(c.downloadCanvas(1));
        //console.log('after');
        //console.log(document);
    };

    var currentLook = new Image();
    currentLook.addEventListener("load", onLoad);  //added handler to run tests when image completed loading
    currentLook.src = "_resources/tree-transparent.png";
    var looks = [];
    looks[0] = currentLook;

    var currentLook2 = new Image();
    currentLook2.addEventListener("load", onLoad2);  //added handler to run tests when image completed loading
    currentLook2.src = "_resources/minion.jpg";
    var looks2 = [];
    looks2[0] = currentLook2;

</script>
</html>
